<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Toolpath Visualization</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
        }

        .label {
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            z-index: 150;
        }

        #labelX {
            color: red;
        }

        #labelY {
            color: green;
        }

        #labelZ {
            color: blue;
        }
    </style>

</head>


<body>
    <input type="range" id="rangeSlider" min="0" max="1" step="0.0001" value="1"
        style="position: absolute; top: 10px; left: 10px; width: 95%;">
    <label id="rangeLabel" style="position: absolute; top: 10px; left: 220px;">100%</label>
    <div class="label" id="labelX">X</div>
    <div class="label" id="labelY">Y</div>
    <div class="label" id="labelZ">Z</div>
    <input type="checkbox" id="toggleLines" checked>
    <input type="checkbox" id="togglePoints" checked>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.150.1/examples/jsm/"
    }
  }
</script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';
        import { WebGLRenderer } from "three";
        import { PointLight } from 'three';
        import { MeshPhongMaterial } from 'three';
        import { PlaneGeometry, Mesh, MeshBasicMaterial } from 'three';

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        scene.background = new THREE.Color(0x565656);

        //****Helpers****//
        const size = 210;
        const divisions = 10;
        const gridHelper = new THREE.GridHelper(size, divisions);
        gridHelper.position.y = size / 2;
        gridHelper.position.x = size / 2;
        gridHelper.rotation.x = 90 * (Math.PI / 180);
        scene.add(gridHelper);

        const cameraHelper = new THREE.CameraHelper(camera);
        scene.add(cameraHelper);

        const axesHelper = new THREE.AxesHelper(50);
        scene.add(axesHelper);

        //***Geometry data***//
        const toolpathData = TOOLPATH_DATA_PLACEHOLDER;
        const slider = document.getElementById("rangeSlider");
        const rangeLabel = document.getElementById("rangeLabel");

        const pointsMaterial = new THREE.PointsMaterial({ size: 0.1, color: 0xff0000 });
        const lineMaterial = new THREE.LineBasicMaterial({ color: 0x05c4bc });

        //Shwing points within range
        slider.addEventListener("input", updateGeometry);

        const lineGeometry = new THREE.BufferGeometry().setFromPoints([]);
        const line = new THREE.Line(lineGeometry, lineMaterial);
        scene.add(line);

        const pointsGeometry = new THREE.BufferGeometry().setFromPoints([]);
        const points = new THREE.Points(pointsGeometry, pointsMaterial);
        scene.add(points);

        function updateGeometry() {
            const value = parseFloat(slider.value);
            rangeLabel.textContent = `${Math.round(value * 100)}%`;

            const endIndex = Math.floor(toolpathData.length * value);

            const tempPoints = toolpathData.slice(0, endIndex);

            const lineGeometry = new THREE.BufferGeometry().setFromPoints(tempPoints);
            const pointsGeometry = new THREE.BufferGeometry().setFromPoints(tempPoints);

            line.geometry.dispose();
            line.geometry = lineGeometry;

            points.geometry.dispose();
            points.geometry = pointsGeometry;
        }
        updateGeometry();

        const toggleLinesCheckbox = document.getElementById('toggleLines');
        const togglePointsCheckbox = document.getElementById('togglePoints');

        toggleLinesCheckbox.addEventListener('change', (event) => {
            line.visible = event.target.checked;
        });

        togglePointsCheckbox.addEventListener('change', (event) => {
            points.visible = event.target.checked;
        });



        // RENDERER AND CONTROLS
        const renderer = new THREE.WebGLRenderer({
            powerPreference: "high-performance",
            antialias: true,
            stencil: false,
            depth: false
        });


        const controls = new OrbitControls(camera, renderer.domElement);
        controls.target = new THREE.Vector3(105, 105, 0);
        controls.enabled = true;
      
// Disable default left-click rotation
controls.mouseButtons.LEFT = null;

// Set middle-click to pan
controls.mouseButtons.MIDDLE = THREE.MOUSE.PAN;

// Set right-click to rotate
controls.mouseButtons.RIGHT = THREE.MOUSE.ROTATE;
controls.enableRotate = true;

// Enable zoom using the mouse scroll
controls.enableZoom = true;
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        camera.position.z = 75;
        camera.position.y = (-105 * 2);
        camera.position.x = 105;

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        animate();
    </script>

</body>

</html>